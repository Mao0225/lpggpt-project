<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>添加IP地址</title>
    <script src="../css/jquery-3.3.1.min.js"></script>
    <link rel="stylesheet" href="../css/bootstrap-4.3.1-dist/css/bootstrap.min.css">
    <style>
        ::-webkit-input-placeholder { color: #8A8A8A; font-size: 12px; }
        ::-moz-placeholder { color: #8A8A8A; font-size: 12px; }
        :-ms-input-placeholder { color: #8A8A8A; font-size: 12px; }
        :-moz-placeholder { color:#8A8A8A; font-size: 12px; }

        .form_box { padding: 20px; }
        .form_box div { margin-bottom: 15px; }
        .form_box label { display: inline-block; width: 100px; text-align: right; margin-right: 10px; }
        .form_box input { width: 300px; padding: 5px; }
        .hint-text { color: #666; font-size: 0.8em; margin-left: 10px; }
        .button-group { margin-left: 110px; margin-top: 20px; }
        .button-group button { padding: 6px 15px; margin-right: 10px; }
        .error-msg { color: red; margin-left: 110px; margin-bottom: 15px; }
    </style>
</head>
<body>
<div class="form_box">
    <!-- 显示后端返回的错误信息 -->
    #if(errorMsg)
    <div class="error-msg">#(errorMsg)</div>
    #end

    <form action="/ipaddress/save" method="post" id="myForm">
        <div>
            <label>设备编号</label>
            <input type="text" name="ipaddress.deviceno" value="" required
                   placeholder="请输入设备编号" />
        </div>
        <div>
            <label>设备开关命令</label>
            <input type="text" name="ipaddress.poweronoff" value=""
                   placeholder="10=正常，20=需要自动重启" required />
            <span class="hint-text">提示：10=正常，20=需要自动重启</span>
        </div>
        <div>
            <label>IP地址</label>
            <input type="text" name="ipaddress.ipaddress" value="" required
                   placeholder="请输入IP地址" />
        </div>
        <div>
            <label>标志</label>
            <input type="text" name="ipaddress.flag" value="" placeholder="可选" />
        </div>
        <div>
            <label>状态</label>
            <input type="text" name="ipaddress.status" value="" placeholder="可选" />
        </div>
        <div>
            <label>预留1</label>
            <input type="text" name="ipaddress.yuliu1" value="" placeholder="可选" />
        </div>
        <div>
            <label>备注</label>
            <input type="text" name="ipaddress.memo" value="" placeholder="可选" />
        </div>
        <div>
            <label>发生时间</label>
            <input type="text" name="ipaddress.happendtime" id="happendtime" readonly />
            <span class="hint-text">系统自动填充当前时间</span>
        </div>

        <div class="button-group">
            <button type="submit" id="saveBtn">保存</button>
            <button type="button" onclick="window.location.href='/ipaddress/iplist'">取消</button>
        </div>
    </form>
</div>

<script>
    // 页面加载时自动填充当前时间
    window.onload = function() {
        const now = new Date();
        const year = now.getFullYear();
        const month = String(now.getMonth() + 1).padStart(2, '0');
        const day = String(now.getDate()).padStart(2, '0');
        const hours = String(now.getHours()).padStart(2, '0');
        const minutes = String(now.getMinutes()).padStart(2, '0');
        const seconds = String(now.getSeconds()).padStart(2, '0');

        const formattedTime = `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;
        document.getElementById('happendtime').value = formattedTime;
    };

    // 表单提交前验证
    document.getElementById('myForm').addEventListener('submit', function(e) {
        const deviceno = document.querySelector('input[name="ipaddress.deviceno"]').value;
        const poweronoff = document.querySelector('input[name="ipaddress.poweronoff"]').value;
        const ip = document.querySelector('input[name="ipaddress.ipaddress"]').value;

        if (!deviceno.trim()) {
            alert('设备编号不能为空');
            e.preventDefault();
            return false;
        }

        if (!['10', '20'].includes(poweronoff.trim())) {
            alert('设备开关命令只能是10或20');
            e.preventDefault();
            return false;
        }

        // IP地址格式验证
        const ipRegex = /^(\d{1,3})\.(\d{1,3})\.(\d{1,3})\.(\d{1,3})$/;
        if (!ipRegex.test(ip.trim())) {
            alert('请输入有效的IP地址');
            e.preventDefault();
            return false;
        }

        return true;
    });
</script>
</body>
</html>