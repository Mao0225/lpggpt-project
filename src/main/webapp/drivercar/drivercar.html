<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Content</title>
    <script src="../css/jquery-3.3.1.min.js"></script>
    <link rel="stylesheet" href="../css/bootstrap-4.3.1-dist/css/bootstrap.min.css" >
    <script src="../css/bootstrap-4.3.1-dist/js/bootstrap.min.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/lpg.css">
    <!-- Add your custom stylesheets and scripts here -->
    <!-- 添加样式 -->


    <style scoped>
        .container {
            padding: 30px 15px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        input {
            padding: 8px 12px;
            font-size: 14px;
            border: 1px solid #a3bffa;
            border-radius: 4px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            transition: border-color 0.3s ease;
        }

        input[type="date"] {
            max-width: 180px;
        }

        input:focus {
            outline: none;
            border-color: #4c87c9;
        }

        select {
            padding: 8px 12px;
            font-size: 14px;
            border: 1px solid #a3bffa;
            border-radius: 4px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            background-color: white;
        }

        button, input[type="submit"], input[type="button"] {
            padding: 6px 12px;
            font-size: 14px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 80px;
        }

        input[type="submit"] {
            background-color: #007bff;
            color: white;
            border: 1px solid #007bff;
            margin-right: 8px;
        }

        input[type="button"] {
            background-color: #f8f9fa;
            color: #333;
            border: 1px solid #ddd;
        }

        input[type="submit"]:hover {
            background-color: #0069d9;
        }

        input[type="button"]:hover {
            background-color: #e2e6ea;
        }

        .form-group {
            display: inline-flex;
            align-items: center;
            margin-right: 15px;
            margin-bottom: 10px;
        }

        .form-group label {
            margin-right: 8px;
            margin-bottom: 0;
            white-space: nowrap;
        }

        .btn-danger {
            padding: 4px 8px;
            font-size: 12px;
        }
    </style>

    <style>
        /* 设置 #pagediv 的样式 */
        #pagediv {
            background-color: #f0f0f0;
            color: black;
            padding: 15px;
            border: 1px solid #007bff;
            border-radius: 4px;
        }

        /* 设置表格样式 */
        table.list {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        /* 设置表格表头样式 */
        table.list th {
            background-color: #add8e6;
            color: black;
            padding: 10px;
            text-align: left;
            border: 1px solid #ddd;
            font-weight: 600;
        }

        /* 设置表格单元格样式 */
        table.list td {
            padding: 10px;
            border: 1px solid #ddd;
        }

        /* 设置表格隔行颜色 */
        table.list tr:nth-child(even) {
            background-color: #f2f2f2;
        }

        table.list tr:nth-child(odd) {
            background-color: #e0e0e0;
        }

        /* 设置鼠标悬停时表格行的颜色 */
        table.list tr:hover {
            background-color: #d3d3d3;
        }

        /* 设置新建司机链接为黑色 */
        #pagediv .add {
            color: white;
            background-color: #007bff;
            padding: 6px 12px;
            text-decoration: none;
            display: inline-block;
            border-radius: 4px;
            font-size: 14px;
        }

        /* 设置输入框背景色为淡灰色 */
        #pagediv input[type="text"] {
            background-color: white;
        }

        /* 设置 label 文字颜色为黑色 */
        #pagediv label {
            color: black;
            margin-right: 5px;
            margin-left: 10px;
        }

        #pagediv label:first-child {
            margin-left: 0;
        }

        /* 检查详情模态框样式 */
        .modal-title {
            font-size: 18px;
            font-weight: 600;
        }

        .modal-body table td {
            padding: 8px;
        }

        .text-red {
            color: red;
        }

        /* 分页样式 */
        .pagination {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .pagination a, .pagination span {
            padding: 6px 12px;
            margin: 0 2px;
            border: 1px solid #ddd;
            border-radius: 4px;
            text-decoration: none;
            color: #007bff;
        }

        .pagination .current {
            background-color: #007bff;
            color: white;
            border-color: #007bff;
        }
    </style>

</head>
<body>
<div id="pagediv">
    <form id="searchForm" action="/drivercar/drivercarlist" method="get">

        <a href="#" class="add openModal" data-title="新建司机" data-edit-url="/drivercar/add"><b> + </b>新建司机</a>

        <label>司机姓名:</label>
        <input type="text" name="drivername" value="#(drivername)"/>

        <label>联系电话:</label>
        <input type="text" name="driverphone" value="#(driverphone)"/>

        <label>车牌号:</label>
        <input type="text" name="drivercarno" value="#(drivercarno)"/>

        <label>车辆名称:</label>
        <input type="text" name="carname" value="#(carname)"/>

        <label>车辆生产日期:</label>
        <input type="text" name="carshengchanriqi" value="#(carshengchanriqi)"/>

        <label>&nbsp;</label>
        <input value="搜索" type="submit">
        <input type="submit" value="重置" name="refresh"/>
    </form>

</div>
<table class="list">
    <div>

        <button id="showFormButton" style="width: 30px; height: 30px; border: 2px solid transparent; border-radius: 50%; background-color: transparent; position: relative; float: right;">
            <img src="/img/find.png" alt="搜索" style="width: 30px; height: 30px; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">
        </button>

        <button id="fresh" name = "refresh" style="width: 30px; height: 30px; border: 2px solid transparent; border-radius: 50%; background-color: transparent; position: relative;  margin-right: 10px;float: right;">
            <img src="/img/refresh2.png" alt="刷新" style="width: 30px; height: 30px; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">
        </button>


        <script>
            var buttons = document.getElementsByName("refresh");
            for (var i = 0; i < buttons.length; i++) {
                buttons[i].addEventListener('click', function() {
                    // 获取所有的输入框并设置为空
                    var inputs = document.querySelectorAll('#searchForm input[type=text]');
                    for (var j = 0; j < inputs.length; j++) {
                        inputs[j].value = "";
                    }

                    // 提交表单以重新查询并刷新页面
                    document.getElementById('searchForm').submit();
                });
            }
        </script>


        <script>
            document.getElementById('showFormButton').addEventListener('click', function() {
                var form = document.getElementById('searchForm');
                if (form.style.display === 'none') {
                    form.style.display = 'block'; // 显示表单
                } else {
                    form.style.display = 'none'; // 再次点击按钮隐藏表单
                }
            });
        </script>
    </div>


    <tbody>
    <tr>
        <th width="2%">Id</th>
        <th width="2%">司机姓名</th>
        <th width="2%">联系方式</th>
        <th width="2%">车载读卡器编号</th>
        <th width="2%">出生日期</th>
        <th width="2%">性别</th>
        <th width="2%">车牌号</th>
        <th width="2%">车辆名称</th>
        <th width="2%">车辆颜色</th>
        <th width="2%">车辆生产日期</th>
        <th width="2%">身份证号</th>
        <th width="2%">危货证件号</th>
        <th width="2%">危货证件有效期</th>
        <th width="2%">操作标识</th>
        <th width="4%">证件照片查看</th>
        <th width="2%">操作</th>
    </tr>
    #set(startIndex = (drivercar.pageNumber - 1) * drivercar.pageSize + 1)

    #for(x : drivercar.getList())
    <tr>
        <td style="text-align:center">#(startIndex++)</td> <!-- 显示序号并递增 -->
        <td style="text-align:center">#(x.drivername)</td>
        <td style="text-align:center">#(x.driverphone)</td>
        <td style="text-align:center">#(x.did)</td>
        <td style="text-align:center">#(x.driverbirthday)</td>
        <td style="text-align:center">#(x.driversex)</td>
        <td style="text-align:center">#(x.drivercarno)</td>
        <td style="text-align:center">#(x.carname)</td>
        <td style="text-align:center">#(x.carcolor)</td>
        <td style="text-align:center">#(x.carshengchanriqi)</td>

        <td style="text-align:center">#(x.identity_card_no)</td>
        <td style="text-align:center">#(x.risk_cargo_license_no)</td>
        <td style="text-align:center">#(x.risk_cargo_license_indate)</td>

        <td style="text-align:center">
            #if(x.update_sign == 1)
            电脑端
            #elseif(x.update_sign == 2)
            APP端
            #else
            未知设备
            #end
        </td>

        <td style="text-align:center">
            <a href="javascript:void(0)" class="show-media"
               data-driver-license="#(x.driver_license_image_url)"
               data-car-image="#(x.car_image_url)"
               data-risk-cargo="#(x.risk_cargo_license_image_url)">
                查看
            </a>
        </td>

        <td style="text-align:center">
            &nbsp;&nbsp;<a href="#" onclick="confirmDelete('#(x.id)')">删除</a>
            <a href="#" class="edit openModal" data-title="编辑用户" data-edit-url="/drivercar/edit/#(x.id)">修改</a>
        </td>

    </tr>
    #end

    <!-- 修改模态窗口结构 -->
    <div class="modal fade" id="mediaModal" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header py-2">
                    <h6 class="modal-title">证件信息核查</h6>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close" style="font-size: 1.2rem">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body p-2">
                    <!-- 驾驶证照片 -->
                    <div class="media-section">
                        <div class="d-flex align-items-center mb-1">
                            <span class="badge badge-sm badge-secondary">驾驶证照片</span>
                            <div class="media-scroll-container" id="driverLicenseGallery"></div>
                        </div>
                    </div>

                    <!-- 车辆照片 -->
                    <div class="media-section">
                        <div class="d-flex align-items-center mb-1">
                            <span class="badge badge-sm badge-secondary">车辆照片</span>
                            <div class="media-scroll-container" id="carImageGallery"></div>
                        </div>
                    </div>

                    <!-- 危货证件 -->
                    <div class="media-section">
                        <div class="d-flex align-items-center mb-1">
                            <span class="badge badge-sm badge-secondary">危货证件</span>
                            <div class="media-scroll-container" id="riskCargoGallery"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 修改脚本中的路径处理 -->
    <script>
        $(document).ready(function() {
            $('.show-media').click(function() {
                $('.media-scroll-container').empty();

                const driverLicense = $(this).data('driver-license') || '';
                const carImage = $(this).data('car-image') || '';
                const riskCargo = $(this).data('risk-cargo') || '';

                // 修改createMediaItems函数中的路径处理逻辑
                function createMediaItems(urls, containerId) {
                    const container = $(containerId);
                    container.empty();

                    if(!urls.trim()) {
                        container.append('<span class="empty-placeholder">暂无数据</span>');
                        return;
                    }

                    const baseUrl = window.location.origin; // 自动获取当前访问域名

                    urls.split(',').forEach(url => {
                        if(url.trim()) {
                            let fullUrl = url.trim();

                            // 路径处理逻辑
                            if(!fullUrl.startsWith('http')) {
                                fullUrl = fullUrl.startsWith('/') ?
                                    `${baseUrl}${fullUrl}` :
                                    `${baseUrl}/upload/temp/drivercar/${fullUrl}`;
                            }

                            const mediaElement = fullUrl.match(/\.(mp4|webm|ogg)$/i) ?
                                `<video controls class="w-100 h-100">
                    <source src="${fullUrl}">
                </video>` :
                                `<img src="${fullUrl}" onclick="showImage('${fullUrl}')">`;

                            container.append(`
                <div class="media-item">
                    ${mediaElement}
                </div>
            `);
                        }
                    });
                }

                createMediaItems(driverLicense, '#driverLicenseGallery');
                createMediaItems(carImage, '#carImageGallery');
                createMediaItems(riskCargo, '#riskCargoGallery');

                $('#mediaModal').modal('show');
            });
        });
    </script>


    <script>
        var imageIndices = {};
        function changeImage(imageId, direction) {
            var imageElement = document.getElementById(imageId);
            var imageUrls = imageElement.dataset.urls.split(',');
            var index = imageIndices[imageId] || 0;
            index = (index + direction + imageUrls.length) % imageUrls.length;
            imageIndices[imageId] = index;
            var imageUrl = imageUrls[index];
            // if (!imageUrl.includes('http')) {
            //     imageUrl = '/upload/drivercar/' + imageUrl;
            // }
            imageElement.src = imageUrl;
        }
        function prevImage(imageId) {
            changeImage(imageId, -1);
        }
        function nextImage(imageId) {
            changeImage(imageId, 1);
        }
    </script>
    </tbody>
    <script>
        function showImage(imageUrl) {
            if(imageUrl == null){

            }
            var img = new Image();
            img.src = imageUrl;
            var mask = document.createElement('div');
            mask.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.7); z-index: 9999;';
            document.body.appendChild(mask);
            var imgContainer = document.createElement('div');
            imgContainer.style.cssText = 'position: fixed; top: 50%; left: 50%; width: auto; height: auto; transform: translate(-50%, -50%); z-index: 10000;';
            imgContainer.appendChild(img);
            document.body.appendChild(imgContainer);

            img.onload = function() {
                var maxWidth = window.innerWidth * 0.8; // Adjust max width as needed
                var maxHeight = window.innerHeight * 0.8; // Adjust max height as needed
                var imgWidth = img.naturalWidth;
                var imgHeight = img.naturalHeight;
                var scaleFactor = Math.min(maxWidth / imgWidth, maxHeight / imgHeight);
                img.style.width = (imgWidth * scaleFactor) + "px";
                img.style.height = (imgHeight * scaleFactor) + "px";
            }

            mask.addEventListener('click', function() {
                mask.parentNode.removeChild(mask);
                imgContainer.parentNode.removeChild(imgContainer);
            });
        }

    </script>
</table>


<div class="pagination" style="color:#000000;">
    #@paginate(drivercar.pageNumber, drivercar.totalPage, "/drivercar/drivercarlist?drivername=" +
    (drivername != null ? drivername : "") + "&driverphone=" + (driverphone != null ? driverphone : "") +
    "&drivercarno=" + (drivercarno != null ? drivercarno : "") + "&carname=" + (carname != null ? carname : "") +
    "&shengchanriqi=" + (carshengchanriqi != null ? carshengchanriqi : "") + "&page=")
</div>


<script>
    function confirmDelete(id) {
        var result = confirm("确定要删除吗？");
        if (result) {
            // 如果用户点击了确定，则执行删除操作
            window.location.href = "/drivercar/delete/" + id;
        } else {
            // 如果用户点击了取消，则不执行任何操作
            return false;
        }
    }
</script>
<script>
    $('.openModal').click(function(e) {
        e.preventDefault();
        var editUrl = $(this).data('edit-url');
        var that = this; // 保存正确的上下文

        $.get(editUrl, function(data) {
            var title = $(that).data('title');
            $('#myModalLabel').text(title); // 修改模态窗口标题

            // 清除旧内容
            $('#modalBody').html(data); // 加载编辑内容到模态窗口
            $('#myModal').modal('show'); // 显示模态窗口

        });
    });

</script>
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content" >
            <div class="modal-header">
                <h4 class="modal-title" id="myModalLabel">模态窗口标题</h4>
            </div>
            <div class="modal-body" id="modalBody" >

                <!-- 这里将会加载你的表单内容 -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                <button type="button" class="btn btn-primary"  id="saveButton" >保存</button>
                <script>
                    function validateForm() {
                        // 正确的日期格式 yyyy-mm-dd
                        const dateFormat = /^\d{4}-\d{2}-\d{2}$/;

                        // 获取所有需要验证的日期输入框
                        const dateInputs = document.querySelectorAll('input[type="text"][name^="drivercar."][name*="indate"], input[type="text"][name^="drivercar."][name*="birthday"], input[type="text"][name^="drivercar."][name*="shengchanriqi"]');

                        for (let i = 0; i < dateInputs.length; i++) {
                            // 如果日期输入框不为空，检查日期格式
                            if (dateInputs[i].value.trim() !== "" && !dateFormat.test(dateInputs[i].value)) {
                                alert('日期格式不正确，无法保存,正确日期格式应为xxxx-xx-xx');
                                return false; // 如果有任何一个日期格式不正确，直接返回false
                            }
                        }

                        return true; // 如果所有字段验证通过，返回true
                    }


                    document.getElementById('saveButton').addEventListener('click', function() {
                        // 验证表单数据
                        if (validateForm()) {
                            // 如果验证通过，则提交表单
                            document.getElementById('myForm').submit();
                        }
                        // 如果验证失败，不提交表单（validateForm内部已经显示了错误消息）
                    });
                </script>
            </div>
        </div>
    </div>
</div>








</body>
</html>
