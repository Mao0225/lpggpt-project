<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Content</title>
    <script src="../css/jquery-3.3.1.min.js"></script>
    <link rel="stylesheet"  type="text/css" href="../css/bootstrap-4.3.1-dist/css/bootstrap.min.css">
    <script src="../css/bootstrap-4.3.1-dist/js/bootstrap.min.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/lpg.css">

    <style scoped>
        .container {
            padding: 50px 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        input, select {
            padding: 8px 12px;
            font-size: 14px;
            border: 1px solid #a3bffa;
            border-radius: 4px;
            width: 150px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            transition: border-color 0.3s ease;
            margin-right: 10px;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #4c87c9;
        }

        input[type="submit"],
        input[type="button"] {
            padding: 6px 12px;
            font-size: 14px;
            border-radius: 4px;
            cursor: pointer;
            border: none;
            width: auto;
            margin-right: 5px;
        }

        input[type="submit"] {
            background-color: #007bff;
            color: white;
        }

        input[type="button"] {
            background-color: #6c757d;
            color: white;
        }
    </style>

    <style>
        #pagediv {
            background-color: #f0f0f0;
            color: black;
            padding: 10px;
            border: 2px solid #007bff;
        }

        table.list {
            width: 100%;
            border-collapse: collapse;
        }

        table.list th {
            background-color: #add8e6;
            color: black;
            padding: 8px;
            text-align: left;
            border: 1px solid #ddd;
        }

        table.list td {
            padding: 8px;
            border: 1px solid #ddd;
        }

        table.list tr:nth-child(even) {
            background-color: #f2f2f2;
        }

        table.list tr:nth-child(odd) {
            background-color: #e0e0e0;
        }

        table.list tr:hover {
            background-color: #d3d3d3;
        }

        #pagediv .add {
            color: black;
        }

        #pagediv input[type="text"], #pagediv select {
            background-color: #f0f0f0;
        }

        #pagediv label {
            color: black;
        }

        #pagediv .add {
            color: white;
            background-color: #007bff;
            padding: 6px 12px;
            text-decoration: none;
            display: inline-block;
            border-radius: 4px;
        }

        /* 过期数据样式 */
        .expired {
            color: red;
        }
    </style>

</head>
<body>
<div id="pagediv">
    <form id="searchForm" action="/gasFile/gasFilelist" method="get">
        <a href="#" class="add openModal" data-title="添加档案" data-edit-url="/gasFile/add"><b>+</b>新建档案</a>
        <label>气瓶编号:</label>
        <input type="text" name="gasNumber" placeholder="输入气瓶编号" value="#(gasNumber)" />
        <input type="text" name="fentiancode" placeholder="输入奉天码" value="#(fentiancode)" />
        <input type="text" name="filling_specification" placeholder="输入充装规格" value="#(filling_specification)" />
        <label>充气站名:</label>
        <input type="text" name="filing_gas_station" placeholder="输入充气站名称" value="#(filing_gas_station)" />

        <label>过期状态:</label>
        <select name="expiredStatus">
            <option value="all" #if(expiredStatus == null || expiredStatus == "all")selected#end>全部</option>
            <option value="expired" #if(expiredStatus == "expired")selected#end>已过期</option>
        </select>

        <!-- 新增：上传状态筛选下拉框 -->
        <label>上传状态:</label>
        <select name="uploadStatus">
            <option value="all" #if(uploadStatus == null || uploadStatus == "all")selected#end>全部</option>
            <option value="1" #if(uploadStatus == "1")selected#end>已上传</option>
            <option value="0" #if(uploadStatus == "0")selected#end>未上传</option>
        </select>


        <label></label>
        <input type="submit" value="搜索"/>
        <input type="submit" value="重置" name="refresh"/>
        <script>
            var buttons = document.getElementsByName("refresh");
            for (var i = 0; i < buttons.length; i++) {
                buttons[i].addEventListener('click', function() {
                    var inputs = document.querySelectorAll('#searchForm input[type=text]');
                    for (var j = 0; j < inputs.length; j++) {
                        inputs[j].value = "";
                    }
                    // 重置下拉框为"全部"
                    document.querySelector('select[name="expiredStatus"]').value = "all";
                    document.querySelector('select[name="uploadStatus"]').value = "all";
                    document.getElementById('searchForm').submit();
                });
            }
        </script>
    </form>
</div>
<table class="list">
    <tbody>
    <tr>
        <th width="10%">序号</th>
        <th width="10%">气瓶编号</th>
        <th width="10%">奉天编码</th>
        <th width="10%">镂空码</th>
        <th width="10%">充气站名</th>
        <th width="10%">制造单位</th>
        <th width="10%">阀体编码</th>
        <th width="10%">气瓶使用登记证</th>
        <th width="10%">制造日期</th>
        <th width="10%">检验日期</th>
        <th width="10%">检验机构</th>
        <th width="10%">定检日期</th>
        <th width="10%">终止使用日期</th>
        <th width="10%">设备品种</th>
        <th width="10%">充装规格</th>
        <th width="10%">气瓶规格</th>
        <th width="10%">充装介质</th>
        <th width="10%">气瓶自重KG</th>
        <th width="10%">许可证号</th>
        <th width="10%">公称压力</th>
        <th width="10%">水试验压</th>
        <th width="10%">容积</th>
        <th width="10%">壁厚</th>

        <th width="10%">建档时间</th>
        <th width="10%">是否专用</th>

        <th width="10%">使用者名称</th>
        <th width="10%">使用者地址</th>
        <th width="10%">电话</th>
        <th width="10%">经度</th>
        <th width="10%">纬度</th>
        <th width="10%">是否上传</th>


        <th width="10%">操作</th>
    </tr>
    #set(startIndex = (gasFiles.pageNumber - 1) * gasFiles.pageSize + 1)

    #for(x : gasFiles.getList())
    <tr>
        <td style="text-align:center">#(startIndex++)</td>
        <td #if(x.terminate_use_date != null && x.terminate_use_date.toString() < currentDate) class="expired"#end>#(x.gas_number)</td>
        <td #if(x.terminate_use_date != null && x.terminate_use_date.toString() < currentDate) class="expired"#end>#(x.fengtiangasno)</td>
        <td #if(x.terminate_use_date != null && x.terminate_use_date.toString() < currentDate) class="expired"#end>#(x.loukongno)</td>
        <td #if(x.terminate_use_date != null && x.terminate_use_date.toString() < currentDate) class="expired"#end>#(x.filing_gas_station)</td>
        <td #if(x.terminate_use_date != null && x.terminate_use_date.toString() < currentDate) class="expired"#end>#(x.manufacture_unit)</td>
        <td #if(x.terminate_use_date != null && x.terminate_use_date.toString() < currentDate) class="expired"#end>#(x.valve_body_code)</td>
        <td #if(x.terminate_use_date != null && x.terminate_use_date.toString() < currentDate) class="expired"#end>#(x.qpsydjzbh)</td>
        <td #if(x.terminate_use_date != null && x.terminate_use_date.toString() < currentDate) class="expired"#end>#(x.manufacture_date)</td>
        <td #if(x.terminate_use_date != null && x.terminate_use_date.toString() < currentDate) class="expired"#end>#(x.inspect_date)</td>
        <td #if(x.terminate_use_date != null && x.terminate_use_date.toString() < currentDate) class="expired"#end>#(x.inspect_unit)</td>
        <td #if(x.terminate_use_date != null && x.terminate_use_date.toString() < currentDate) class="expired"#end>#(x.regular_check_date)</td>
        <td #if(x.terminate_use_date != null && x.terminate_use_date.toString() < currentDate) class="expired"#end>#(x.terminate_use_date)</td>
        <td #if(x.terminate_use_date != null && x.terminate_use_date.toString() < currentDate) class="expired"#end>#(x.monitoring_station)</td>
        <td #if(x.terminate_use_date != null && x.terminate_use_date.toString() < currentDate) class="expired"#end>#(x.filling_specification)</td>
        <td #if(x.terminate_use_date != null && x.terminate_use_date.toString() < currentDate) class="expired"#end>#(x.gas_specification)</td>
        <td #if(x.terminate_use_date != null && x.terminate_use_date.toString() < currentDate) class="expired"#end>#(x.filling_medium)</td>
        <td #if(x.terminate_use_date != null && x.terminate_use_date.toString() < currentDate) class="expired"#end>#(x.gas_suttle)</td>
        <td #if(x.terminate_use_date != null && x.terminate_use_date.toString() < currentDate) class="expired"#end>#(x.xukezhenghao)</td>
        <td #if(x.terminate_use_date != null && x.terminate_use_date.toString() < currentDate) class="expired"#end>#(x.gongchengyali)</td>
        <td #if(x.terminate_use_date != null && x.terminate_use_date.toString() < currentDate) class="expired"#end>#(x.shuishiyanya)</td>
        <td #if(x.terminate_use_date != null && x.terminate_use_date.toString() < currentDate) class="expired"#end>#(x.rongji)</td>
        <td #if(x.terminate_use_date != null && x.terminate_use_date.toString() < currentDate) class="expired"#end>#(x.bihou)</td>
        <td #if(x.terminate_use_date != null && x.terminate_use_date.toString() < currentDate) class="expired"#end>#(x.jiandangshijian)</td>
        <td #if(x.terminate_use_date != null && x.terminate_use_date.toString() < currentDate) class="expired"#end>#(x.shifouzhuanyong)</td>
        <td #if(x.terminate_use_date != null && x.terminate_use_date.toString() < currentDate) class="expired"#end>#(x.shiyongzhemingcheng)</td>
        <td #if(x.terminate_use_date != null && x.terminate_use_date.toString() < currentDate) class="expired"#end>#(x.shiyongzhedizhi)</td>
        <td #if(x.terminate_use_date != null && x.terminate_use_date.toString() < currentDate) class="expired"#end>#(x.shiyongzhedianhua)</td>
        <td #if(x.terminate_use_date != null && x.terminate_use_date.toString() < currentDate) class="expired"#end>#(x.shiyongzhejingdu)</td>
        <td #if(x.terminate_use_date != null && x.terminate_use_date.toString() < currentDate) class="expired"#end>#(x.shiyongzheweidu)</td>
        <!-- 修改：显示上传状态文字 -->
        <td #if(x.terminate_use_date != null && x.terminate_use_date.toString() < currentDate) class="expired"#end>
        #if(x.upload_status == 1)已上传#else未上传#end
        </td>

        <td style="text-align:left; padding: 8px;">
            <a href="#" onclick="confirmDelete('#(x.id)')" style="margin-right: 10px; color: #dc3545; text-decoration: none;">
                <button type="button" class="btn btn-sm btn-danger">删除</button>
            </a>
            <a href="#" class="openModal" data-title="修改档案" data-edit-url="/gasFile/edit/#(x.id)" style="text-decoration: none;">
                <button type="button" class="btn btn-sm btn-primary">修改</button>
            </a>
        </td>
    </tr>
    #end
    </tbody>
</table>
<!-- 修改分页部分，添加上传状态参数 -->
<div class="pagination">
    #@paginate(gasFiles.pageNumber, gasFiles.totalPage,
    "/gasFile/gasFilelist?gasNumber=" + (gasNumber != null ? gasNumber : "")
    + "&fentiancode=" + (fentiancode != null ? fentiancode : "")
    + "&filling_specification=" + (filling_specification != null ? filling_specification : "")
    + "&expiredStatus=" + (expiredStatus != null ? expiredStatus : "all")
    + "&uploadStatus=" + (uploadStatus != null ? uploadStatus : "all")
    + "&page=")
</div>


<script>
    function confirmDelete(id) {
        // 获取当前搜索条件，包括上传状态
        var gasNumber = document.querySelector('input[name="gasNumber"]').value;
        var fentiancode = document.querySelector('input[name="fentiancode"]').value;
        var filling_specification = document.querySelector('input[name="filling_specification"]').value;
        var expiredStatus = document.querySelector('select[name="expiredStatus"]').value;
        var uploadStatus = document.querySelector('select[name="uploadStatus"]').value;

        var result = confirm("确定要删除吗？");
        if (result) {
            // 构造带参数的删除URL，包含上传状态
            var deleteUrl = "/gasFile/delete/" + id
                + "?gasNumber=" + encodeURIComponent(gasNumber)
                + "&fentiancode=" + encodeURIComponent(fentiancode)
                + "&filling_specification=" + encodeURIComponent(filling_specification)
                + "&expiredStatus=" + encodeURIComponent(expiredStatus)
                + "&uploadStatus=" + encodeURIComponent(uploadStatus);

            window.location.href = deleteUrl;
        }
    }
</script>

<script>
    $('.openModal').click(function(e) {
        console.log("askl;jdilasjdiowjdiojaiwdjiowa");
        e.preventDefault();
        var editUrl = $(this).data('edit-url');
        var that = this;
        $.get(editUrl, function(data) {
            var title = $(that).data('title');
            $('#myModalLabel').text(title);
            $('#modalBody').html(data);
            $('#myModal').modal('show');
        });
    });

</script>
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="myModalLabel">模态窗口标题</h4>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- 表单内容 -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                <button type="button" class="btn btn-primary"  id="saveButton" >保存</button>
                <script>
                    function validateForm() {
                        const dateFormat = /^\d{4}-\d{2}-\d{2}$/;
                        const inputs = document.querySelectorAll('input[type="text"][name^="gas_file."]');

                        for (let i = 0; i < inputs.length; i++) {
                            if (inputs[i].name.includes("date") && inputs[i].value.trim() !== "" && !dateFormat.test(inputs[i].value)) {
                                alert('日期格式不正确，无法保存,正确格式为xxxx-xx-xx');
                                return false;
                            }
                        }
                        return true;
                    }

                    document.getElementById('saveButton').addEventListener('click', function() {
                        if (validateForm()) {
                            document.getElementById('myForm').submit();
                        }
                    });
                </script>
            </div>
        </div>
    </div>
</div>

</body>
</html>